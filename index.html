<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>Ableton Web</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="theme-color" content="#111">
<link rel="manifest" href="manifest.json">

<style>
body{
  margin:0;
  background:#111;
  color:#fff;
  font-family:system-ui;
}
header{
  padding:10px 16px;
  background:#1a1a1a;
  display:flex;
  align-items:center;
  gap:16px;
}
.grid{
  display:grid;
  grid-template-columns:repeat(8,1fr);
  gap:6px;
  padding:10px;
}
.clip{
  height:60px;
  background:#222;
  border-radius:6px;
  display:flex;
  align-items:center;
  justify-content:center;
  cursor:pointer;
  user-select:none;
  transition:.1s;
}
.clip.ready{ background:#2d7d46; }
.clip.playing{
  background:#3cff8f;
  box-shadow:0 0 20px #3cff8f;
}
.clip:active{ transform:scale(.95); }

.controls{
  padding:10px;
  background:#1a1a1a;
  display:flex;
  gap:10px;
}
button,input{
  background:#222;
  color:#fff;
  border:none;
  padding:8px 12px;
  border-radius:6px;
}
</style>
</head>

<body>

<header>
  <strong>Ableton Web – Session</strong>
  <span>BPM</span>
  <input type="range" id="bpm" min="60" max="160" value="120">
</header>

<div class="grid" id="grid"></div>

<div class="controls">
  <button onclick="stopAll()">⏹ Stop All</button>
</div>

<script>
const ctx=new (window.AudioContext||webkitAudioContext)();
const grid=document.getElementById("grid");
const bpmInput=document.getElementById("bpm");

const tracks=8;
const scenes=6;
let clips=[];
let buffers=[];

// örnek sesler
const sounds=[
 "https://cdn.pixabay.com/audio/2022/03/15/audio_54cce1a5f3.mp3",
 "https://cdn.pixabay.com/audio/2022/03/15/audio_23c7c0c04c.mp3",
 "https://cdn.pixabay.com/audio/2022/03/15/audio_9fdfda9c8a.mp3",
 "https://cdn.pixabay.com/audio/2022/03/15/audio_4c16e6a6a2.mp3"
];

(async()=>{
 for(const s of sounds){
  const r=await fetch(s);
  buffers.push(await ctx.decodeAudioData(await r.arrayBuffer()));
 }
 buildGrid();
})();

function buildGrid(){
 for(let s=0;s<scenes;s++){
  for(let t=0;t<tracks;t++){
   const d=document.createElement("div");
   d.className="clip ready";
   d.textContent=`Clip`;
   d.onclick=()=>launchClip(d,t);
   grid.appendChild(d);
   clips.push({el:d,track:t,playing:false});
  }
 }
}

function launchClip(el,track){
 stopTrack(track);
 el.classList.add("playing");
 el.playing=true;

 const src=ctx.createBufferSource();
 src.buffer=buffers[track%buffers.length];
 src.loop=true;
 src.connect(ctx.destination);
 src.start();
 el.src=src;
}

function stopTrack(track){
 clips.filter(c=>c.track===track && c.playing).forEach(c=>{
  c.src.stop();
  c.el.classList.remove("playing");
  c.playing=false;
 });
}

function stopAll(){
 clips.filter(c=>c.playing).forEach(c=>{
  c.src.stop();
  c.el.classList.remove("playing");
  c.playing=false;
 });
}

// MIDI Launchpad
navigator.requestMIDIAccess?.().then(m=>{
 for(const i of m.inputs.values()){
  i.onmidimessage=e=>{
   const note=e.data[1];
   const c=clips[note%clips.length];
   if(c) c.el.click();
  };
 }
});

// PWA
if("serviceWorker"in navigator){
 navigator.serviceWorker.register("sw.js");
}
</script>

</body>
</html>
